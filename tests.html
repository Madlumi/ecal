
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy tests</title>
  <script src="energy.js"></script>
</head>
<body>
<pre id="results"></pre>
<script>
(function(){
  const out = document.getElementById('results');
  function log(msg) {
    out.textContent += msg + '\n';
  }
  function assertStrictEqual(actual, expected, label) {
    if (actual !== expected) {
      throw new Error(label + ': expected ' + expected + ' but got ' + actual);
    }
  }
  function round(x) {
    return Math.round(x * 1000) / 1000;
  }

  try {
    // Case 1: small house with some electric heating and cooling
    const h1 = new House(HouseType.SMALL, 100, locations[1]);
    h1.E.heat[EType.ELECTRIC] = 120;
    h1.E.cool[EType.FJARRKYLA] = 40;
    assertStrictEqual(EPpet(h1), 2, 'EPpet small house');
    let lim = limit(h1);
    assertStrictEqual(lim.EP, 95, 'EP small house');
    assertStrictEqual(round(lim.EL), 4.5, 'EL small house');
    assertStrictEqual(lim.UM, 0.30, 'UM small house');
    assertStrictEqual(lim.LL, -1, 'LL small house');

    // Case 2: multi dwelling house on Ã…land with ventilation adjustments
    const h2 = new House(HouseType.MULTI, 200, locations[0]);
    h2.flow = 0.4;
    h2.qavg = 0.4;
    h2.foot4 = true;
    h2.foot5 = true;
    assertStrictEqual(EPpet(h2), 0, 'EPpet multi house');
    lim = limit(h2);
    assertStrictEqual(lim.EP, 77, 'EP multi house');
    assertStrictEqual(round(lim.EL), 6.8, 'EL multi house');
    assertStrictEqual(lim.UM, 0.40, 'UM multi house');
    assertStrictEqual(lim.LL, -1, 'LL multi house');

    // Case 3: local building with footnote adjustments
    const h3 = new House(HouseType.LOCAL, 60, locations[1]);
    h3.qavg = 0.4;
    h3.flow = 0.5;
    h3.foot2 = true;
    h3.foot3 = true;
    assertStrictEqual(EPpet(h3), 0, 'EPpet local');
    lim = limit(h3);
    assertStrictEqual(lim.EP, 72, 'EP local');
    assertStrictEqual(round(lim.EL), 4.698, 'EL local');
    assertStrictEqual(lim.UM, 0.50, 'UM local');
    assertStrictEqual(lim.LL, -1, 'LL local');

    log('All tests passed.');
  } catch (e) {
    log('Test failed: ' + e.message);
    throw e;
  }
})();
</script>
</body>
</html>

